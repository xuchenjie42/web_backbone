'use strict';

var fs = require('fs');

module.exports = {
  compile: function(src, model) {
    model = model && model.toJSON && model.toJSON() || model;
    return require('underscore').template(src, null, { variable: 'data' })(model);
  },
  copy: function(src, dst, model, cb) {
    fs.readFile(src, 'utf-8', function(err, data) {
      err && console.warn(err);
      
      if(data) {
        var template = this.compile(data, model);

        require('fs-extra').mkdirs(require('path').dirname(dst), function() {
          fs.writeFile(dst, template, 'utf-8', function(err) {
            err && console.warn(err);
            cb();
          });
        });
      }
    }.bind(this));
  }
};