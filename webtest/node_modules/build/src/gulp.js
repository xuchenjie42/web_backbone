'use strict';

var paths = require('./paths');

module.exports = function(options) {
  var fs = require('fs');
  var task = process.argv[2];

  task = task.split(/:/)[0];
  
  var lookup = [
    paths.target.task().append(task).abs(),
    paths.target.scheme(task).append('scheme').abs(),
    paths.target.scheme(task).append('task').append(task).abs(),
    paths.self.task().append(task).abs()
  ];
  
  global.gulp = options.gulp; // meh
  
  for(var i = 0, length = lookup.length; i < length; ++i) {
    var path = lookup[i];

    if(fs.existsSync(path + '.js')) {
      var Task = require(path);
      new Task(options.gulp, require(paths.self.src().append('plugins').abs()));
      break;
    }
  }
};