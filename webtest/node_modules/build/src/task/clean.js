'use strict';

var fs = require('fs-extra-promise');
var Promise = require('promise');

module.exports = require('../task').extend({
  name: 'clean',
  execute: function() {
    var root = './build/' + this.parent.name;
    var promise = Promise.resolve();

    var paths = [
      root + '/public/res',
      root + '/public/src',
      root + '/dist'
    ];

    if(this.config.paths) {
      paths = paths.concat(this.config.paths.map(function(path) {
        return root + '/' + path;
      }));
    }

    if(require('fs').existsSync(root)) {
      for(var i = 0, length = paths.length; i < length; ++i) {
        var path = paths[i];

        if(require('fs').existsSync(path)) {
          promise = promise.then(this.remove.bind(this, path));
        }
      }
    }

    return promise;
  },
  remove: function(path) {
    return fs.removeAsync(path);
  }
}, { export: 'Clean' });
