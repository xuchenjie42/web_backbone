'use strict';

var gulp = require('gulp');
var imagemin = require('gulp-imagemin');
var plumber = require('gulp-plumber');
var pngquant = require('imagemin-pngquant');
var watch = require('gulp-watch');
var sprite = require('gulp.spritesmith');

module.exports = function (paths, scheme) {
  gulp.task('sprite:min', function () {
    return gulp.src('./res/image/sprite/**/*')
      .pipe(imagemin({
        optimizationLevel: 5,
        progressive: true,
        use: [pngquant()]
      }))
      .pipe(gulp.dest('./build/debug/out/sprite/'));
  });

  gulp.task('sprite', function () {
    //var out = gulp.src('./build/debug/out/sprite/**/*')
    var out = gulp.src(paths.sprite)
      //      .pipe(watch())
      //      .pipe(plumber())
      .pipe(sprite({
        imgName: 'sprite.png',
        imgPath: '../image/sprite.png',
        cssName: 'sprite.css'
      }));

    out.img.pipe(gulp.dest(paths.dest.image));
    out.css.pipe(gulp.dest(paths.dest.style));
  });
};